 CREATE TABLE imap_mime( filename CHAR(64) NOT NULL, path VARCHAR(255), contentType VARCHAR(255), b_begin INT, b_body INT, b_end INT, l_header INT, l_body INT, UNIQUE IDX_imap_mime_1 (filename,path)); CREATE TABLE domain( domain VARCHAR(200) NOT NULL, owner VARCHAR(100) NOT NULL, PRIMARY KEY (domain)); CREATE TABLE spool( id INT NOT NULL AUTO_INCREMENT, filename CHAR(64) NOT NULL, name VARCHAR(100) NOT NULL, domain VARCHAR(200) NOT NULL, next DATETIME, retry INT NOT NULL, s_name VARCHAR(100) NOT NULL, s_domain VARCHAR(200) NOT NULL, FOREIGN KEY (s_domain) REFERENCES domain (domain), PRIMARY KEY (id)); CREATE TABLE mail_user( id INT NOT NULL AUTO_INCREMENT, name VARCHAR(100) NOT NULL, domain VARCHAR(200) NOT NULL, passwd CHAR(30) NOT NULL, last DATETIME, address CHAR(15), keep TINYINT, FOREIGN KEY (domain) REFERENCES domain (domain), PRIMARY KEY (id)); CREATE TABLE forward( id INT NOT NULL AUTO_INCREMENT, user_id INT NOT NULL, forward VARCHAR(255) NOT NULL, notify TINYINT, FOREIGN KEY (user_id) REFERENCES mail_user (id), PRIMARY KEY (id)); CREATE TABLE imap_unit( id INT NOT NULL AUTO_INCREMENT, base VARCHAR(128), PRIMARY KEY (id), UNIQUE UC_id (id), UNIQUE IDX_imap_unit_1 (id,base)); CREATE TABLE imap_folder( id INT NOT NULL AUTO_INCREMENT, imap_unit_id INT NOT NULL, path VARCHAR(255) NOT NULL, last DATETIME, FOREIGN KEY (imap_unit_id) REFERENCES imap_unit (id), PRIMARY KEY (id), UNIQUE UC_id (id), UNIQUE IDX_imap_folder_1 (imap_unit_id,path)); CREATE TABLE mail_user_imap_unit( mail_user_id INT NOT NULL, imap_unit_id INT NOT NULL, r_write TINYINT, r_delete TINYINT, FOREIGN KEY (imap_unit_id) REFERENCES imap_unit (id), FOREIGN KEY (mail_user_id) REFERENCES mail_user (id), PRIMARY KEY (mail_user_id,imap_unit_id)); CREATE TABLE imap_subs( id INT NOT NULL AUTO_INCREMENT, mail_user_id INT NOT NULL, path VARCHAR(255) NOT NULL, FOREIGN KEY (mail_user_id) REFERENCES mail_user (id), PRIMARY KEY (id), UNIQUE UC_id (id), UNIQUE IDX_imap_subs_1 (mail_user_id,path)); CREATE TABLE imap_data( id INT NOT NULL AUTO_INCREMENT, imap_folder_id INT, imap_mime_filename CHAR(64), last DATETIME, f_answered TINYINT, f_flagged TINYINT, f_deleted TINYINT, f_seen TINYINT, f_draft TINYINT, size INT NOT NULL, FOREIGN KEY (imap_folder_id) REFERENCES imap_folder (id), PRIMARY KEY (id), UNIQUE UC_id (id)); 
